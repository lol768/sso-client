1) Include sso-client.jar in your deploy directory and your project classpath in Eclipse.
Also put all of the dist/dependencies/*.jar files in your JBoss classpath (%JBOSS_HOME/server/default/lib).

Put the dist/dependencies/endorsed/*.jar in your %JAVA_HOME/jre/lib/endorsed/ directory
(or just copy the endorsed directory if this does not already exist).  Delete existing xerces and xml
api jar files.

Put the dist/dependencies/endorsed/*.jar in your %JBOSS_HOME%/lib/endorsed/ directory
(or just copy the endorsed directory if this does not already exist).
Delete existing xerces and xml api jar files.

2) Add the following snippets to your web.xml:

<!-- The "/sso-config.xml" reference should be renamed to be more specific to your web app, eg. "/blogs-sso-config.xml" -->
  <context-param>
    <param-name>ssoclient.config</param-name>
    <param-value>/sso-config.xml</param-value>
  </context-param>

  <filter>
      <filter-name>SSOClientFilter</filter-name>
        <filter-class>uk.ac.warwick.sso.client.SSOClientFilter</filter-class>
    </filter>

  <!-- map this filter over everything that will be protected by SSO -->
  <filter-mapping>
        <filter-name>SSOClientFilter</filter-name>
        <url-pattern>*.spr</url-pattern>
    </filter-mapping>

  <listener>
      <listener-class>uk.ac.warwick.sso.client.SSOConfigLoader</listener-class>
  </listener>

  <servlet>
      <servlet-name>ShireServlet</servlet-name>
      <display-name>Shire</display-name>
      <servlet-class>uk.ac.warwick.sso.client.ShireServlet</servlet-class>
</servlet>

  <servlet>
      <servlet-name>LogoutServlet</servlet-name>
      <display-name>Shire</display-name>
      <servlet-class>uk.ac.warwick.sso.client.LogoutServlet</servlet-class>
  </servlet>

  <servlet-mapping>
      <servlet-name>ShireServlet</servlet-name>
      <url-pattern>/shire</url-pattern>
  </servlet-mapping>

  <servlet-mapping>
      <servlet-name>LogoutServlet</servlet-name>
      <url-pattern>/logout</url-pattern>
  </servlet-mapping>

(Unless your web.xml is generated by XDoclet, then you need to add these to the relevant files in the merge dir)

3) Copy and rename (as above) the example "sso-config.xml" file from the sso-client dist directory to your JBoss conf directory

4) Edit this file to get all of the right settings for your service

5) Alter your code where you get the logged in user to simply get the User object out of the request from the SSO_USER key

6) Alter your login links to look something like this:

<c:choose>
  <c:when test="${SSO_USER != null && SSO_USER.loggedIn == true}">
    <p><a href="<sso:logoutlink target="" />">Sign out</a></p>
  </c:when>
  <c:otherwise>
    <p><a href="<sso:loginlink target="" />">Sign in</a></p>
  </c:otherwise>
</c:choose>

7) Generating a CSR for your app:

Open a DOS prompt and navigate to your %JAVA_HOME/jre/lib/security directory.

# keytool -keystore <your_domain_name>.keystore -alias <your_domain_name> -genkey -keyalg RSA

first and last name = your hostname
organizational unit = Information Technology Services
your organization = The University of Warwick
city or Locality = Coventry
State or province = West Midlands
2 letter country code for this unit = GB

# keytool -certreq -alias <your_domain_name> -keystore <your_domain_name>.keystore -file <your_domain_name>.csr

# skip the following line on test machines - only use if you're going to use SSL and Apache
# java -classpath . ExportPriv <your_domain_name>.keystore <your_domain_name> <keystore_password>

8) Give the <your_domain_name>.csr file to the SSO administrator, they will generate a certificate for you.

9) When you get the certificate <your_domain_name>.crt.der, import it back into the keystore, along with the Root CRT if needs be:

# keytool -import -keystore cacerts -alias testsso-ca -file testsso-ca.crt.der -trustcacerts

# keytool -import -keystore cacerts -alias verisign-intermediate -file verisign-intermediate-ca.crt -trustcacerts

# keytool -import -keystore <your_domain_name>.keystore -alias testsso-ca -file testsso-ca.crt.der -trustcacerts

# keytool -import -keystore <your_domain_name>.keystore -alias websignon.warwick.ac.uk -file websignon.warwick.ac.uk.crt.der -trustcacerts

# keytool -import -keystore <your_domain_name>.keystore -alias <your_domain_name> -file <your_domain_name>.crt.der -trustcacerts

10)  Send following settings to SSO Administrator:

provider id:
e.g. <providerid>urn:go.warwick.ac.uk:sarahgoto:service</providerid>

root url (combo of hostname/path)
e.g. http://host-137-205-194-214.csv.warwick.ac.uk:8080/goto

alias:
e.g. Sarah's Go Test

name and email of person responsible for service:

url of your Shire:
e.g. https://host-137-205-194-214.csv.warwick.ac.uk:8080/goto/shire

your logout url:
e.g. https://host-137-205-194-214.csv.warwick.ac.uk:8080/goto/logout

11) Configure Apache/Jboss to run SSL with the right certificates...hard.

add this snippet to your Jboss deploy dir/jbossweb-tomcat50.sar/server.xml:

      <Connector port="443"
                     maxThreads="150" minSpareThreads="25" maxSpareThreads="75"
                     enableLookups="false" disableUploadTimeout="true"
                     acceptCount="100" debug="0" scheme="https" secure="true"
                     clientAuth="true" sslProtocol="TLS" keystoreFile="C:\j2sdk1.4.2_02\jre\lib\security\host-137-205-194-214.csv.warwick.ac.uk.keystore"
                     keystorePass="changeit"
                     truststoreFile="C:\j2sdk1.4.2_02\jre\lib\security\host-137-205-194-214.csv.warwick.ac.uk.keystore"
               truststorePass="changeit" />

(amending file names as appropriate)
